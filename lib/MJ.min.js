if(typeof(MJ)==="undefined"){MJ={}}MJ.Agari=function(b,a){this.tehai=a;this.tsumo=b.tsumo;this.atari_pai=b.getAtari();this.pai_array=b.get();this.pai_count=b.pais};if(typeof(MJ)==="undefined"){MJ={}}MJ.Tehai=function(){this.pais={};this.count=0;this.atari=null;this.__cache={}};MJ.Tehai.prototype.ALL_PAI=["1m","2m","3m","4m","5m","6m","7m","8m","9m","1s","2s","3s","4s","5s","6s","7s","8s","9s","1p","2p","3p","4p","5p","6p","7p","8p","9p","東","南","西","北","白","發","中"];MJ.Tehai.prototype.PAI_MAP={};MJ.Tehai.prototype.PAI_RMAP={};(function(){var e="A".charCodeAt(0);for(var a=0;a<MJ.Tehai.prototype.ALL_PAI.length;a++,e++){var d=String.fromCharCode(e);var b=MJ.Tehai.prototype.ALL_PAI[a];MJ.Tehai.prototype.PAI_MAP[b]=d;MJ.Tehai.prototype.PAI_RMAP[d]=b}})();MJ.Tehai.prototype.get=function(){if(this.__cache.pai_array){return this.__cache.pai_array}if(this.count<14){return null}var c=[];for(var a in this.pais){for(var b=0;b<this.pais[a];b++){c.push(this.PAI_MAP[a])}}c.sort();for(var b=0;b<c.length;b++){c[b]=this.PAI_RMAP[c[b]]}this.__cache.pai_array=c;return this.__cache.pai_array};MJ.Tehai.prototype.add=function(b,a){if(!this.__isValidPai(b)){return false}var c=this.pais[b]||0;if(c>=4){return false}this.pais[b]=c+1;this.count++;this.__cache={};if(a){this.setAtari(b)}return true};MJ.Tehai.prototype.addAll=function(b,a){var c=true;for(var d=0;d<b.length;d++){if(!this.add(b[d])){c=false}}if(a){if(!this.setAtari(a)){c=false}}return c};MJ.Tehai.prototype.remove=function(a){if(!this.__isValidPai(a)){return false}var b=this.pais[a]||0;if(b<=0){return false}this.pais[a]=b-1;this.count--;this.__cache={};if(b==1&&this.atari==a){this.atari=null}return true};MJ.Tehai.prototype.setAtari=function(a){if(!this.__isValidPai(a)){return false}if(!this.pais[a]){return false}this.atari=a;this.__cache={};return true};MJ.Tehai.prototype.getAtari=function(){return this.atari};MJ.Tehai.prototype.__isValidPai=function(a){return this.PAI_MAP[a]};MJ.Tehai.prototype.getAgariPattern=function(){if(this.__cache.agari_pattern){return this.__cache.agari_pattern}this.__cache.agari_pattern=this.__searchAgari();return this.__cache.agari_pattern};MJ.Tehai.prototype.__searchAgari=function(){var b=[];var f=[];var e=true;for(var c in this.pais){if(this.pais[c]>=2){f.push(c)}if(this.pais[c]!=2){e=false}}if(e){b.push(new MJ.Agari(this,{is_chiitoi:true}))}else{if(f.length==1){var a=new MJ.Agari(this,{is_chiitoi:false});if(MJ.Hantei._Yakuman.isKokushimusou(a)){this.__pushAgari({atama:f[0],result:b},[],undefined)}}}for(var d=0;d<f.length;d++){this.__searchAgari2({atama:f[d],result:b})}return b};MJ.Tehai.prototype.__searchAgari2=function(d){var b={};for(var a in this.pais){b[a]=this.pais[a]}b[d.atama]-=2;d.used_pais=b;var c=this.__searchAgari3(d);this.__searchAgari4(d,c)};MJ.Tehai.prototype.__searchAgari3=function(d){var b={};for(var a in d.used_pais){b[a]=d.used_pais[a]}var e=[];do{var c=null;if(((c=this.__getKoutsu(b))||(c=this.__getShuntsu(b)))){e.push(c)}else{break}}while(this.__checkUkihai(b));if(e.length<4){return null}return this.__pushAgari(d,e,null)};MJ.Tehai.prototype.__searchAgari4=function(d,c){var a=d.used_pais;var e=[];do{var b=null;if(((b=this.__getShuntsu(a))||(b=this.__getKoutsu(a)))){e.push(b)}else{break}}while(this.__checkUkihai(a));if(e.length<4){return null}return this.__pushAgari(d,e,c)};MJ.Tehai.prototype.__getKoutsu=function(c){var a=this.get();for(var d=0;d<a.length;d++){var b=a[d];if(!c[b]){continue}if(c[b]>=3){c[b]-=3;return{is_koutsu:true,p1:b,p2:b,p3:b}}break}return null};MJ.Tehai.prototype.__getShuntsu=function(c){var a=this.get();for(var e=0;e<a.length;e++){var b=a[e];if(!c[b]){continue}var d=b.match(/^([1-7])([msp])$/);if(!d){break}var g=(parseInt(d[1])+1)+d[2];var f=(parseInt(d[1])+2)+d[2];if(c[g]&&c[f]){c[b]--;c[g]--;c[f]--;return{is_koutsu:false,p1:b,p2:g,p3:f}}break}return null};MJ.Tehai.prototype.__checkUkihai=function(b){for(var a in b){if(b[a]){return true}}return false};MJ.Tehai.prototype.__pushAgari=function(f,g,e){var c={atama:f.atama,is_chiitoi:false,koutsu:[],shuntsu:[]};for(var b=0;b<g.length;b++){var a=g[b];if(a.is_koutsu){c.koutsu.push(a.p1)}else{c.shuntsu.push(a.p1)}}var d=("k=["+c.koutsu.join(",")+"]&s=["+c.shuntsu.join(",")+"]");if(!e||(e!=d)){f.result.push(new MJ.Agari(this,c))}return d};if(typeof(MJ)==="undefined"){MJ={}}MJ.Hantei=MJ.Hantei||{};MJ.Hantei.getYakuArray=function(a){var b=null;b=MJ.Hantei._Yakuman.checkAll(a);if(b&&b.length){return b}b=[];if(MJ.Hantei._6Han.isChinitsu(a)){b.push({name:"清一色",han:6})}else{if(MJ.Hantei._3Han.isHonitsu(a)){b.push({name:"混一色",han:3})}else{if(MJ.Hantei._2Han.isSanshokudoujun(a)){b.push({name:"三色同順",han:2})}else{if(MJ.Hantei._2Han.isSanshokudoukou(a)){b.push({name:"三色同刻",han:2})}}}}if(MJ.Hantei._3Han.isRyanpeikou(a)){b.push({name:"二盃口",han:3})}else{if(MJ.Hantei._1Han.isIipeikou(a)){b.push({name:"一盃口",han:1})}else{if(MJ.Hantei._2Han.isToitoihou(a)){b.push({name:"対々和",han:2})}else{if(MJ.Hantei._2Han.isChiitoitsu(a)){b.push({name:"七対子",han:2})}}}}if(MJ.Hantei._3Han.isJuntyan(a)){b.push({name:"純全帯",han:3})}else{if(MJ.Hantei._2Han.isHonroutou(a)){b.push({name:"混老頭",han:2})}else{if(MJ.Hantei._2Han.isTyanta(a)){b.push({name:"全帯",han:2})}else{if(MJ.Hantei._1Han.isTanyao(a)){b.push({name:"断ヤオ",han:1})}else{if(MJ.Hantei._2Han.isIkkituukan(a)){b.push({name:"一気通貫",han:2})}}}}}if(MJ.Hantei._2Han.isShousangen(a)){b.push({name:"小三元",han:2})}if(MJ.Hantei._1Han.isPinfu(a)){b.push({name:"平和",han:1})}else{if(MJ.Hantei._2Han.isSanankou(a)){b.push({name:"三暗刻",han:2})}}return b};MJ.Hantei.getResult=function(h){var d=h.getAgariPattern();var g=null;var e=0;for(var b=0;b<d.length;b++){var a=MJ.Hantei.getYakuArray(d[b]);var f=0;for(var c=0;c<a.length;c++){f+=a[c].han}if(f>e){g=a;e=f}}return g};if(typeof(MJ)==="undefined"){MJ={}}MJ.Hantei=MJ.Hantei||{};MJ.Hantei._1Han=MJ.Hantei._1Han||{};MJ.Hantei._1Han.isPinfu=function(e){if(e.tehai.is_chiitoi){return false}if(e.tehai.shuntsu.length<4){return false}if(e.tehai.atama.match(/^(白|發|中)$/)){return false}if(e.atari_pai){for(var c=0;c<e.tehai.shuntsu.length;c++){var a=e.tehai.shuntsu[c];if(e.atari_pai==a&&!a.match(/^7/)){return true}var b=a.match(/^([1-7])([msp])$/);var d=(parseInt(b[1])+2)+b[2];if(e.atari_pai==d&&!d.match(/^3/)){return true}}return false}return true};MJ.Hantei._1Han.isTanyao=function(b){for(var a=0;a<b.pai_array.length;a++){if(b.pai_array[a].match(/^[^2-8]/)){return false}}return true};MJ.Hantei._1Han.isIipeikou=function(c){if(c.tehai.is_chiitoi){return false}var d={};for(var b=0;b<c.tehai.shuntsu.length;b++){var a=c.tehai.shuntsu[b];d[a]=(d[a]||0)+1}for(var a in d){if(d[a]>=2){return true}}return false};if(typeof(MJ)==="undefined"){MJ={}}MJ.Hantei=MJ.Hantei||{};MJ.Hantei._2Han=MJ.Hantei._2Han||{};MJ.Hantei._2Han.isSanshokudoujun=function(e){if(e.tehai.is_chiitoi){return false}if(e.tehai.shuntsu.length<3){return false}var g={};var f={};for(var d=0;d<e.tehai.shuntsu.length;d++){var b=e.tehai.shuntsu[d];var c=b.match(/^([1-7])/);var a=parseInt(c[1]);g[a]=(g[a]||0)+1;f[b]=(f[b]||0)+1}var d=0;for(var a in g){if(++d>2){break}if(f[a+"m"]&&f[a+"s"]&&f[a+"p"]){return true}}return false};MJ.Hantei._2Han.isIkkituukan=function(e){if(e.tehai.is_chiitoi){return false}var f={};for(var c=0;c<e.tehai.shuntsu.length;c++){var a=e.tehai.shuntsu[c];f[a]=(f[a]||0)+1}var b=["m","s","p"];for(var c=0;c<b.length;c++){var d=b[c];if((f[1+d]&&f[4+d]&&f[7+d])){return true}}return false};MJ.Hantei._2Han.isTyanta=function(c){if(c.tehai.is_chiitoi){return false}if(c.tehai.atama.match(/^[2-8]/)){return false}for(var b=0;b<c.tehai.koutsu.length;b++){var a=c.tehai.koutsu[b];if(a.match(/^[2-8]/)){return false}}for(var b=0;b<c.tehai.shuntsu.length;b++){var a=c.tehai.shuntsu[b];if(a.match(/^[2-6]/)){return false}}return true};MJ.Hantei._2Han.isChiitoitsu=function(a){return a.tehai.is_chiitoi};MJ.Hantei._2Han.isToitoihou=function(a){if(a.tehai.is_chiitoi){return false}if(a.tehai.shuntsu.length){return false}return true};MJ.Hantei._2Han.isSanankou=function(a){if(a.tehai.is_chiitoi){return false}return(a.tehai.koutsu.length>=3)};MJ.Hantei._2Han.isHonroutou=function(c){for(var b=0;b<c.pai_array.length;b++){var a=c.pai_array[b];if(a.match(/^[2-8]/)){return false}}return true};MJ.Hantei._2Han.isSanshokudoukou=function(e){if(e.tehai.is_chiitoi){return false}if(e.tehai.koutsu.length<3){return false}var g={};var f={};for(var d=0;d<e.tehai.koutsu.length;d++){var b=e.tehai.koutsu[d];var c=b.match(/^([1-9])/);if(!c){continue}var a=parseInt(c[1]);g[a]=(g[a]||0)+1;f[b]=(f[b]||0)+1}var d=0;for(var a in g){if(++d>2){break}if(f[a+"m"]&&f[a+"s"]&&f[a+"p"]){return true}}return false};MJ.Hantei._2Han.isSankantsu=function(a){return false};MJ.Hantei._2Han.isShousangen=function(a){if(a.tehai.is_chiitoi){return false}switch(a.tehai.atama){case"白":return(a.pai_count["發"]>=3&&a.pai_count["中"]>=3);case"發":return(a.pai_count["白"]>=3&&a.pai_count["中"]>=3);case"中":return(a.pai_count["白"]>=3&&a.pai_count["發"]>=3)}return false};if(typeof(MJ)==="undefined"){MJ={}}MJ.Hantei=MJ.Hantei||{};MJ.Hantei._3Han=MJ.Hantei._3Han||{};MJ.Hantei._3Han.isHonitsu=function(d){if(!d.pai_array[0].match(/^[1-9]([msp])$/)){return true}var a=RegExp.$1;for(var b=1;b<d.pai_array.length;b++){if(!d.pai_array[b].match(/^[1-9]([msp])$/)){continue}var c=RegExp.$1;if(c!=a){return false}}return true};MJ.Hantei._3Han.isJuntyan=function(c){if(c.tehai.is_chiitoi){return false}if(!c.tehai.atama.match(/^[19]/)){return false}for(var b=0;b<c.tehai.koutsu.length;b++){var a=c.tehai.koutsu[b];if(!a.match(/^[19]/)){return false}}for(var b=0;b<c.tehai.shuntsu.length;b++){var a=c.tehai.shuntsu[b];if(!a.match(/^[17]/)){return false}}return true};MJ.Hantei._3Han.isRyanpeikou=function(c){if(c.tehai.is_chiitoi){return false}var d={};for(var b=0;b<c.tehai.shuntsu.length;b++){var a=c.tehai.shuntsu[b];d[a]=(d[a]||0)+1}var e=0;for(var a in d){if(d[a]==4){return true}if(d[a]>=2){e++}}return(e>=2)};if(typeof(MJ)==="undefined"){MJ={}}MJ.Hantei=MJ.Hantei||{};MJ.Hantei._6Han=MJ.Hantei._6Han||{};MJ.Hantei._6Han.isChinitsu=function(d){if(!d.pai_array[0].match(/^[1-9]([msp])$/)){return false}var a=RegExp.$1;for(var b=1;b<d.pai_array.length;b++){if(!d.pai_array[b].match(/^[1-9]([msp])$/)){return false}var c=RegExp.$1;if(c!=a){return false}}return true};if(typeof(MJ)==="undefined"){MJ={}}MJ.Hantei=MJ.Hantei||{};MJ.Hantei._Yakuman=MJ.Hantei._Yakuman||{};MJ.Hantei._Yakuman.checkAll=function(b){var a=[];if(MJ.Hantei._Yakuman.isKokushimusou(b)){if(MJ.Hantei._Yakuman.isKokushimusou13men(b)){a.push({name:"国士無双13面待ち",han:26})}else{a.push({name:"国士無双",han:13})}return a}if(MJ.Hantei._Yakuman.isChurenpoutou(b)){if(MJ.Hantei._Yakuman.isZyunseiChurenpoutou(b)){a.push({name:"純正九連宝燈",han:26})}else{a.push({name:"九連宝燈",han:13})}return a}if(MJ.Hantei._Yakuman.isSuuankou(b)){if(MJ.Hantei._Yakuman.isSuuankouTanki(b)){a.push({name:"四暗刻単騎",han:26})}else{a.push({name:"四暗刻",han:13})}}if(MJ.Hantei._Yakuman.isDaisangen(b)){a.push({name:"大三元",han:13})}if(MJ.Hantei._Yakuman.isTsuuiso(b)){a.push({name:"字一色",han:13})}if(MJ.Hantei._Yakuman.isChinrouto(b)){a.push({name:"清老頭",han:13})}if(MJ.Hantei._Yakuman.isDaisuusii(b)){a.push({name:"大四喜",han:26})}else{if(MJ.Hantei._Yakuman.isShousuusii(b)){a.push({name:"小四喜和",han:13})}}if(MJ.Hantei._Yakuman.isRyuuiisou(b)){a.push({name:"緑一色",han:13})}return a};MJ.Hantei._Yakuman.isKokushimusou=function(d){var a=["1m","9m","1s","9s","1p","9p","東","南","西","北","白","發","中"];var e=0;for(var c=0;c<a.length;c++){var b=a[c];if(!(b in d.pai_count)){return false}if(d.pai_count[b]>2){return false}}return true};MJ.Hantei._Yakuman.isKokushimusou13men=function(a){if(!MJ.Hantei._Yakuman.isKokushimusou(a)){return false}return(a.tehai.atama==a.atari_pai)};MJ.Hantei._Yakuman.isChurenpoutou=function(a){if(!MJ.Hantei._6Han.isChinitsu(a)){return false}return MJ.Hantei._Yakuman.isChurenpoutou_2nd(a)};MJ.Hantei._Yakuman.isChurenpoutou_2nd=function(d){var b=d.pai_array[0].match(/\d(m|s|p)/)[1];for(var c=1;c<=9;c++){var a=String(c)+b;if(!(a in d.pai_count)){return false}switch(c){case 1:case 9:if(d.pai_count[a]<3){return false}break;case 2:case 3:case 4:case 5:case 6:case 7:case 8:if(d.pai_count[a]>2){return false}break}}return true};MJ.Hantei._Yakuman.isZyunseiChurenpoutou=function(d){if(!MJ.Hantei._6Han.isChinitsu(d)){return false}var c=undefined;var e=[];for(var b=0;b<d.pai_array.length;b++){var a=d.pai_array[b];if(d.atari_pai==a&&c==undefined){c=a;--d.pai_count[a]}else{e.push(a)}}d.pai_array=e;return MJ.Hantei._Yakuman.isChurenpoutou_2nd(d)};MJ.Hantei._Yakuman.isSuuankouTanki=function(a){if(MJ.Hantei._Yakuman.isSuuankou(a)==false){return false}return(a.tehai.atama==a.atari_pai)};MJ.Hantei._Yakuman.isSuuankou=function(a){return(a.tehai.koutsu.length==4)};MJ.Hantei._Yakuman.isDaisangen=function(d){var a=["白","發","中"];for(var b=0;b<a.length;b++){var c=a[b];if(!(c in d.pai_count)){return false}if(d.pai_count[c]<3){return false}}return true};MJ.Hantei._Yakuman.isTsuuiso=function(b){var a=new RegExp;a.compile("^[東南西北白發中]$");for(key in b.pai_count){if(a.test(key)==false){return false}}return true};MJ.Hantei._Yakuman.isChinrouto=function(b){var a=new RegExp;a.compile("^(1|9)(m|s|p)$");for(key in b.pai_count){if(a.test(key)==false){return false}}return true};MJ.Hantei._Yakuman.__kazehaiAnkoLength=function(e){var a=["東","南","西","北"];var d=0;for(var c=0;c<a.length;c++){var b=a[c];if(!(b in e.pai_count)){continue}if(e.pai_count[b]==3){++d}}return d};MJ.Hantei._Yakuman.isShousuusii=function(a){if(MJ.Hantei._Yakuman.__kazehaiAnkoLength(a)==3){if(a.tehai.atama.match(/^(東|南|西|北)$/)){return true}}return false};MJ.Hantei._Yakuman.isDaisuusii=function(a){return(MJ.Hantei._Yakuman.__kazehaiAnkoLength(a)==4)};MJ.Hantei._Yakuman.isRyuuiisou=function(b){var a=["2s","3s","4s","6s","8s","發"];for(key in b.pai_count){if(a.indexOf(key)==-1){return false}}return true};MJ=MJ||{};MJ.TokutenKeisan=function(){};MJ.TokutenKeisan.calcFu=function(f,g){var h=0;if(f.tehai.is_chiitoi){return 25}h+=20;var d=g?MJ.TokutenKeisan.__hasPinfu(g):false;if(g&&!d){h+=2}for(var c=0;c<f.tehai.koutsu.length;c++){if(f.tehai.koutsu[c].match(/^[2-8]/)){h+=4}else{h+=8}}if(f.tehai.atama.match(/^(白|發|中)$/)){h+=2}if(d){}else{if(f.atari_pai==f.tehai.atama){h+=2}else{if(f.atari_pai.match(/^[2-8]/)){var e=false;if(f.atari_pai.match(/^3/)){var a=f.atari_pai.replace(/^3/,"1");for(var c=0;c<f.tehai.shuntsu.length;c++){if(a==f.tehai.shuntsu[c]){h+=2;e=true;break}}}else{if(f.atari_pai.match(/^7/)){var a=f.atari_pai;for(var c=0;c<f.tehai.shuntsu.length;c++){if(a==f.tehai.shuntsu[c]){h+=2;e=true;break}}}}if(!e){var b=f.atari_pai.match(/^([2-8])([msp])$/);var a=(parseInt(b[1])-1)+b[2];for(var c=0;c<f.tehai.shuntsu.length;c++){if(a==f.tehai.shuntsu[c]){h+=2;break}}}}}}return Math.ceil(h/10)*10};MJ.TokutenKeisan.__hasPinfu=function(b){for(var a=0;a<b.length;a++){if(b[a].name=="平和"){return true}}return false};